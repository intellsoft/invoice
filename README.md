# 🧾 فاکتورساز آنلاین حرفه‌ای

<div dir="rtl" align="right">

[![Vanilla JS](https://img.shields.io/badge/Vanilla-JS-blue)](#-فناوری‌های-استفاده‌شده)
[![PWA Ready](https://img.shields.io/badge/PWA-ready-success)](#-pwa--آفلاین)
[![No Backend](https://img.shields.io/badge/Backend-None-informational)](#-حریم-خصوصی--ذخیره‌سازی)
[![RTL](https://img.shields.io/badge/RTL-fa--IR-critical)](#-امکانات-و-ویژگی‌ها)
[![Open Source](https://img.shields.io/badge/Open--Source-Yes-brightgreen)](#-مجوز)

یک نرم‌افزار تحت‌وب فارسی و راست‌چین برای **طراحی و چاپ فاکتورهای حرفه‌ای**، سبک، سریع و بدون نیاز به سرور. نسخهٔ قبلی پروژه نیز همین اهداف را با رابط فارسی، چاپ مستقیم و ذخیرهٔ محلی دنبال می‌کرد. 

---

## فهرست مطالب

* [✨ چه چیزهایی تازه شده؟](#-چه-چیزهایی-تازه-شده)
* [🏁 شروع سریع](#-شروع-سریع)
* [🎯 امکانات و ویژگی‌ها](#-امکانات-و-ویژگی‌ها)
* [⌨️ میانبرهای صفحه‌کلید](#️-میانبرهای-صفحه‌کلید)
* [💾 پشتیبان‌گیری و مهاجرت داده‌ها](#-پشتیبان‌گیری-و-مهاجرت-داده‌ها)
* [📦 ساختار پروژه](#-ساختار-پروژه)
* [🔧 تنظیمات و نکات فنی](#-تنظیمات-و-نکات-فنی)
* [🧩 کتابخانه‌ها و وابستگی‌ها](#-کتابخانه‌ها-و-وابستگی‌ها)
* [🧠 عیب‌یابی و نکات مهم](#-عیب‌یابی-و-نکات-مهم)
* [🤝 مشارکت](#-مشارکت)
* [📄 مجوز](#-مجوز)

---

## ✨ چه چیزهایی تازه شده؟

* **حفظ شفافیت لوگوی PNG** هنگام آپلود و در خروجی‌ها (جلوگیری از پس‌زمینهٔ مشکی).
* **امنیت بالاتر در رندر** (حذف `innerHTML` برای ردیف‌ها و استفادهٔ امن از DOM برای پیشگیری از XSS).
* **ستون «واحد»** برای آیتم‌ها (عدد/کیلو/متر/ساعت/…).
* **تخفیف ردیفی مبلغی یا درصدی** (برای هر آیتم مستقل).
* **نرمال‌سازی ارقام فارسی** در ورودی‌های عددی + پشتیبانی اعشار (`step="0.01"`).
* **Drag & Drop** برای جابه‌جایی ترتیب ردیف‌ها.
* **میانبرهای صفحه‌کلید:** `Ctrl+S` ذخیرهٔ پیش‌نویس، `Ctrl+P` چاپ، `Ctrl+Enter` افزودن آیتم.
* **چاپ حرفه‌ای‌تر:** تکرار سربرگ جدول در صفحات بعدی، عدم شکست سطر وسط صفحه، کنترل حاشیه با `@page`.
* **خروجی PDF/PNG شارپ‌تر** (افزایش مقیاس رندر در `html2canvas`).
* **Export/Import JSON** برای انتقال/پشتیبان‌گیری فاکتورها + **جست‌وجو** در فاکتورهای ذخیره‌شده.
* **شناسهٔ یکتا (UUID)** برای هر فاکتور.
* **PWA & آفلاین:** Manifest + Service Worker → نصب روی موبایل/دسکتاپ و اجرای آفلاین.
* **دسترس‌پذیری بهتر:** اعلان ذخیره با `aria-live="polite"` و `role="status"`.

> نسخهٔ قبلی هم از **jsPDF** و **html2canvas** برای خروجی‌ها استفاده می‌کرد که در این نسخه نیز بهینه شده‌اند. 

---

## 🏁 شروع سریع

### اجرای محلی (برای فعال‌شدن PWA حتماً از روی HTTP/HTTPS سرو کنید)

**Python:**

```bash
python -m http.server 8000
# سپس: http://localhost:8000
```

**Node.js (serve):**

```bash
npx serve .
```

> برای نصب به‌صورت اپ (Add to Home Screen) و کش آفلاین، **Service Worker** باید از روی دامنه/لوکال‌سرور فعال شود.

---

## 🎯 امکانات و ویژگی‌ها

* **رابط فارسی و راست‌چین**، طراحی واکنش‌گرا.
* **اطلاعات فروشنده/مشتری** + **آپلود لوگو** (پشتیبانی از PNG شفاف).
* **مدیریت آیتم‌ها** (افزودن/حذف/ویرایش) + ستون **واحد** برای هر آیتم.
* **تخفیف ردیفی** (مبلغی/درصدی) + **VAT قابل تنظیم** (فعالسازی/درصد دلخواه).
* **محاسبهٔ خودکار** جمع سطر، جمع جزء، VAT، تخفیف و جمع کل.
* **پشتیبانی تومان/ریال** و **نمایش اعداد به‌صورت فارسی**.
* **پیش‌نمایش داخل مودال** + **چاپ مستقیم** + **خروجی PDF و PNG** (A4/A5).
* **ذخیره‌سازی محلی (Local-first)** بدون سرور + **ذخیرهٔ خودکار** هر ۵ ثانیه.
* **مدیریت فاکتورهای ذخیره‌شده** (مشاهده/چاپ/حذف) + **جست‌وجو**.
* **پشتیبان‌گیری و بازیابی JSON** برای انتقال بین دستگاه‌ها/مرورگرها.
* **PWA و آفلاین**: نصب روی موبایل/دسکتاپ و اجرا بدون اینترنت پس از اولین بار.
  (این‌ها در نسخهٔ پیشین نیز به‌شکل پایه موجود بود و اکنون کامل‌تر شده است.) 

---

## ⌨️ میانبرهای صفحه‌کلید

| میانبر         | عملکرد           |
| -------------- | ---------------- |
| `Ctrl + S`     | ذخیرهٔ پیش‌نویس  |
| `Ctrl + P`     | چاپ              |
| `Ctrl + Enter` | افزودن آیتم جدید |

---

## 💾 پشتیبان‌گیری و مهاجرت داده‌ها

* از بخش «فاکتورهای ذخیره‌شده» می‌توانید **Export JSON** بگیرید و در دستگاه دیگر **Import** کنید.
* برای خروجی نهایی: **PDF/PNG** را ذخیره کنید (بخش «پیش‌نمایش»).

> نسخهٔ قدیم ذخیره‌سازی محلی و چاپ مستقیم را فراهم کرده بود؛ در این نسخه Export/Import JSON هم افزوده شده است. 

---

## 📦 ساختار پروژه

```
.
├─ index.html                # برنامه (UI + منطق)
├─ manifest.webmanifest      # تنظیمات PWA
├─ sw.js                     # Service Worker برای آفلاین/کش
├─ /assets                   # (اختیاری) فونت/تصاویر/آیکن‌ها
└─ README.md
```

> در نسخهٔ اولیه از همین الگوی تک‌صفحه به‌همراه jsPDF/html2canvas استفاده شده بود. 

---

## 🔧 تنظیمات و نکات فنی

* **واحد پول:** تغییر تومان/ریال، برچسب‌ها و محاسبات فوراً به‌روزرسانی می‌شود.
* **VAT:** می‌توانید VAT را فعال/غیرفعال و درصد دلخواه تعیین کنید.
* **کیفیت خروجی:** مقیاس رندر `html2canvas` برای PDF/PNG افزایش یافته تا خروجی شارپ باشد.
* **امنیت ورودی‌ها:** رندر سطرها با ساخت امن DOM (بدون `innerHTML`) برای جلوگیری از XSS.
* **ذخیرهٔ خودکار:** هر ۵ ثانیه بدون نمایش اعلان؛ ذخیرهٔ دستی اعلان قابل‌خواندن برای Screen Reader دارد.

---

## 🧩 کتابخانه‌ها و وابستگی‌ها

* **Vanilla JS, HTML5, CSS3** (بدون فریم‌ورک)
* **LocalStorage** برای ذخیرهٔ داده‌ها (بدون نیاز به بک‌اند) — از ابتدا همین رویکرد اتخاذ شده بود. 
* **[jsPDF]** برای تولید PDF و **[html2canvas]** برای رندر تصویر از HTML — در نسخهٔ قبلی هم استفاده می‌شدند. 

---

## 🧠 عیب‌یابی و نکات مهم

* **لوگوی PNG شفاف سیاه می‌شود؟**
  اکنون مسیر پردازش لوگو شفافیت را حفظ می‌کند. اگر قبلاً لوگو را ذخیره کرده‌اید، یک‌بار **لوگو را دوباره آپلود** کنید تا نسخهٔ جدید جایگزین شود (ممکن است نسخهٔ قدیمی در LocalStorage مانده باشد).
* **Service Worker فعال نمی‌شود؟**
  فایل را از روی **HTTP/HTTPS** سرو کنید (باز کردن مستقیم با `file://` باعث غیرفعال شدن SW می‌شود).
* **از دست رفتن داده‌ها؟**
  پاک‌کردن کش مرورگر داده‌ها را حذف می‌کند؛ قبل از تغییر مرورگر/دستگاه از **Export JSON** استفاده کنید.

---

## 🤝 مشارکت

* خوشحال می‌شویم **Issue** یا **Pull Request** ثبت کنید.
* ایده‌های پیشنهادی آینده (Roadmap کوتاه): قالب‌های متعدد، QR پرداخت، هزینهٔ حمل/سایر هزینه‌ها، دفترچه مشتری/کالا (Autocomplete).

**طراحی و توسعه توسط [اینتل سافت](http://intellsoft.ir)**. 

---

## 📄 مجوز

این نرم‌افزار **رایگان و متن‌باز** است. (در صورت نیاز می‌توانید فایل LICENSE را اضافه کنید.) 

</div>


اگر بخواهی، می‌توانم همین README را با **نمونه‌اسکرین‌شات‌ها** و **آیکن‌های PWA** (برای Badges زیباتر) هم تکمیل کنم—کافی است تصاویر را بدهی تا بخش «Screenshots» را اضافه کنم.
